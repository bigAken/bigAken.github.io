# TCP 三次握手

> 面试中面试官经常问到，东西是挺简单的，但硬是记不住，比较尴尬，所以自己总结一下 tcp 三次握手。

首先，在计算机网络用语当中，要严格区分大小写：
ACK为确认包的意思，而ack为acknowledge number，确认号码的意思，两者完全不同；
同理，SYN是建立连接包，不存在syn；

其次，务必搞懂TCP，TCP是传输控制协议，当数据从我的电脑传到服务器时，相当于建立了一个虚拟连接，我们把它称为http请求，就是在网页中输入地址url，产生的http请求，请求发生后，我的电脑和服务器之间产生了TCP连接，这个连接的过程称为双方的三次握手；

那么就很好懂了，第一次握手：首先我方发送一个SYN包，给这个包弄个序列号吧，于是计算机随机产生了一个序列号seq=x，序列号为x，seq是序号的意思；
第二次握手：服务器收到了这个请求包，返回一个响应包ACK包+SYN包，这里服务器也随机产生了一个序列号，seq=y，同时为了表示确定对该ip产生的连接，这样ack=x+1，也就是我的电脑发生序列号+1，当然这里面也可以+2，但是这是计算机协议的规定要+1，就像我们人类可以规定1+1等于2，也可以规定1+1等于3，所以你这个问题相当于在问，为什么1+1不能等于3呢，只是通用，好记，所以返回的序列号用+1来表示，就像你跟你邻居建立 连接，你是201户，你把数据给了门卫，门卫再交到202户手里，所以这个+1的含义在这。

第三次握手：我方收到服务器的SYN+ACK包，则我方再发送个响应包ACK包，其中ack=y+1即可。
通过三次握手确认一个连接产生，那么SYN=1，ACK=1又代表什么呢，这就是一个计算机高低电平，0是低电平，1是高电平，最原始的计算机通过0和1代表有效无效，仅仅代表这个包确认有效，SYN=1，SYN包有效，ACK=0，ACK包无效，ACK包不存在的意思罢了

## 总结 SYN + (SYN+ack) + ack 三次数据包

- 第一次握手 client 会发送一个 SYN 数据包到 server 端，这个 SYN 数据包携带的内容有 `SYN = 1，seq = x`。
- 第二次握手 server 收到 client 的请求后会发送一个 SYN+ack 的数据包给 client，让 client 知道服务器已经收到请求，携带的内中为`SYN = 1，seq = y，ACK =1，ack=x+1`。
- 第三次握手 client 收到 server 的请求后会发送一个 ack 的数据包给 server 确认，携带的内中为`seq = x+1,ACK = 1，ack = y+1`。

> ack 确认号通常为接收到 seq+1，是告诉 client 端下一次发送 seq 以 ack 为开始；seq 通常为 ack 的值，如果第一次发送的话，因为 ack 没有值所以会 seq

示意图如下

![示意图](./image/Snipaste_2022-03-31_23-03-39.png)

> 首先注意一下:
> 当发送 syn 标记时将消耗一个序号；
> 发送 fin 标记时将消耗一个序号；
> 数据是每个字节一个序号；

## TCP 报文， TCP 首部，名词解释

![tcp报文](./image/Snipaste_2022-03-31_23-12-55.png)

![tcp首部](./image/Snipaste_2022-03-31_23-11-14.png)

- ISN：Initial Sequence Number，初始化序列号，在进行三次握手时，会用 ISN 为 SYN 赋值从而进行序号的初始化。

- SYN：synchronous 建立联机，SYN 标志位，SYN =1 就表示发送要求与接收方建立连接，一般与 ACK 标志位搭配使用。

- seq：Sequence，32 位序号，就是我们常说的序号。假设某时序号为 1000，简单的理解就是发送方告诉接收端“我发送的数据是从第 1000 开始的”。

- ack：acknowledgement，32 位确认序号，就是我们常说的确认序号。确认序号是上一次已经成功接收到序号加 1。还可以理解为接收端告诉发送端下一次想接收开始序号。

- ACK：ACK 标志位，当 ACK 为 1 时表示 32 位确认序号有效。

## 文章参考[TCP 报文详解](https://juejin.cn/post/6958440414336516110)
