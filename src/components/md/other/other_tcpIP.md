# TCP/IP

> 应传网链

TCP/IP（Transmission Control Protocol/Internet Protocol，传输控制协议/网际协议）是指能够在多个不同网络间实现信息传输的协议簇。

TCP/IP 协议不仅仅指的是 TCP 和 IP 两个协议，而是指一个由 FTP、SMTP、TCP、UDP、IP 等协议构成的协议簇， 只是因为在 TCP/IP 协议中 TCP 协议和 IP 协议最具代表性，所以被称为 TCP/IP 协议。
TCP/IP 传输协议是严格来说是一个四层的体系结构，应用层、传输层、网络层和数据链路层都包含其中。主要指传输层的 TCP 和网络层的 IP。

## TCP 和 UDP 有什么区别

- 连接方面:TCP 面向连接。UDP 是无连接的，发送数据之前不需要建立连接
- 安全方面:TCP 提供可靠的服务，保证传送的数据，无差错，不丢失，不重复，且按序到达。UDP 则是尽最大努力交付，不保证可靠交付
- 传输效率：TCP 传输效率相对较低，UDP 传输效率高

## 为什么说 TCP 是可靠的连接

TCP 的连接是基于三次握手，而断开则是四次挥手

为了保障数据不丢失及错误（可靠性），它有报文校验、ACK 应答、超时重传(发送方)、失序数据重传（接收方）、丢弃重复数据、流量控制（滑动窗口）和拥塞控制等机制

## 具体说一说三次握手和四次挥手机制

### 三次握手 SYN + (SYN+ack) + ack

- 第一次握手 client 会发送一个 SYN 数据包到 server 端，这个 SYN 数据包携带的内容有 `SYN = 1，seq = x`。
- 第二次握手 server 收到 client 的请求后会发送一个 SYN+ack 的数据包给 client，让 client 知道服务器已经收到请求，携带的内中为`SYN = 1，seq = y，ACK =1，ack=x+1`。
- 第三次握手 client 收到 server 的请求后会发送一个 ack 的数据包给 server 确认，携带的内中为`seq = x+1,ACK = 1，ack = y+1`。

### 四次挥手 FIN+ACK+FIN+ACK

- 一次挥手：客户端打算关闭连接，此时会发送一个 TCP 首部 FIN 标志位被置为 1 的报文，也即 FIN 报文，之后客户端进入 FIN_WAIT_1 状态。

- 二次挥手：服务端收到该报文后，就向客户端发送 ACK 应答报文，接着服务端进入 CLOSED_WAIT 状态。

- 三次挥手：客户端收到服务端的 ACK 应答报文后，之后进入 FIN_WAIT_2 状态。等待服务端处理完数据后，也向客户端发送 FIN 报文，之后服务端进入 LAST_ACK 状态。

- 四次挥手：客户端收到服务端的 FIN 报文后，回一个 ACK 应答报文，之后进入 TIME_WAIT 状态
  服务器收到了 ACK 应答报文后，就进入了 CLOSED 状态，至此服务端已经完成连接的关闭。
  客户端在经过 2MSL 一段时间后，自动进入 CLOSED 状态，至此客户端也完成连接的关闭。
